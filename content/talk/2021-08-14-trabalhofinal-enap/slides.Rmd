---
title: "An√°lise estat√≠stica descritiva com uso de R"
subtitle: "An√°lise bidimensional: Correla√ß√£o linear e chi-quadrado"
author: 
  - "Mar√≠lia Melo Favalesso"
output:
  xaringan::moon_reader:
    css: [xaringan-themer.css, style.css]
    nature:
      highlightStyle: github
      highlightLines: true
      ratio: 16:9
---
background-image: url(fig/background.png)
background-size: cover

.center[
## .big-text[Hola!]

### Mar√≠lia Melo Favalesso

.pull-left[
<img style="border: 2px solid #555; border-radius: 70%;" src="fig/me.png" width="200px"/>

`r icons::icon_style(icons::fontawesome("envelope", style = "solid"), fill = "#000000")` [mariliabioufpr@gmail.com](mariliabioufpr@gmail.com) 
`r icons::icon_style(icons::fontawesome("globe-americas", style = "solid"), fill = "#000000")` [www.mmfava.com](www.mmfava.com)
`r icons::icon_style(icons::fontawesome("github"), fill = "#000000")` [ github.com/mmfava](https://github.com/mmfava)
]
]

.pull-right[
.center[**Educa√ß√£o**]

`r icons::icon_style(icons::fontawesome("graduation-cap", style = "solid"), fill = "#000000")` Estudante de doutorado em ['Ecolog√≠a, Gen√©tica y Evoluci√≥n'](http://www.ege.fcen.uba.ar/home/), 2018 - atual, *Universidad de Buenos Aires*, Argentina.
<br>

`r icons::icon_style(icons::fontawesome("graduation-cap", style = "solid"), fill = "#000000")` [Mestre em Conserva√ß√£o e Manejo de Recursos Naturais](https://www5.unioeste.br/portalunioeste/pos/pprn), 2016 - 2018, Universidade estadual do Oeste do Paran√°, Brasil.
<br>

`r icons::icon_style(icons::fontawesome("graduation-cap", style = "solid"), fill = "#000000")` [Bacharela em Ci√™ncias Biol√≥gicas](http://www.palotina.ufpr.br/portal/ciencias-biologicas/), 2010 - 2014, Universidade Federal do Paran√°, Brasil.
<br>

`r icons::icon_style(icons::fontawesome("graduation-cap", style = "solid"), fill = "#000000")` [T√©cnica em Meio-ambiente](https://www.ceepcascavel.com.br/), 2005 - 2009, CEEP Pedro Boaretto Neto, Brasil.
]

---
## Lembre-se!

### **Pergunte, pergunte & perguntas!** ‚úãüé§ üí¨
<br>

### **Aula de revis√£o de conte√∫dos e exerc√≠cios!** ‚úèÔ∏è
<br>

### **De prefer√™ncia, mantenha a c√¢mera ligada** üì∑
<br>

### **Respeitar os colegas e a profa.** üëä
<br>

### **Tentar se divertir durante a aula.** ü•≥
<br>

---
## Conte√∫do program√°tico da mini-aula

- [O que √© correla√ß√£o](#correlation)
   - [Correla√ß√£o ‚â† Causalidade](#causalidade)

- [Correla√ß√£o linear](#cor_linear)
   - [Coeficiente de correla√ß√£o produto-momento (r)](#dir)
   - [Exerc√≠cio](#exe1)

- $\chi^2$ [de associa√ß√£o](#qui)
   - [Res√≠duos ajustados](#qui)
   - [Exerc√≠cio](#exe2)

---
name: correlation
class: middle, center

# O que √© correla√ß√£o?

---
## O que √© correla√ß√£o?

> Em estat√≠stica, a **correla√ß√£o** mede a **dire√ß√£o** e a **intensidade** de uma rela√ß√£o entre duas vari√°veis.


- Por exemplo:

  - **‚Üë**üå°Ô∏è **‚Üë**üçß**?**
  
  - **‚Üë**üìö **‚Üë**üí∞**?**
  
  - **‚Üë**üçÜ **‚Üì**üê∑**?**
  
  - **‚Üë**üö¥ **‚Üì**üí®**?**
  
  - **‚Üë**üôã  **‚Üë**ü¶µ**?**
  
  - **‚Üë**üö¨  **‚Üë**üëÉ**?**
  
> Quando se pode demonstrar que existe associa√ß√£o entre duas vari√°veis, isto √©, quando se constata que elas variam juntas, diz-se que as vari√°veis est√£o **correlacionadas**. 

---
## O que √© correla√ß√£o?

### Correla√ß√£o ‚â† Causalidade

.center[
### **‚Üë**ü¶µ ~ **‚Üë**üôã **?**

```{r echo=FALSE, fig.height=5, fig.width=6, message=FALSE, warning=FALSE, dev.args=list(bg = 'transparent')}
library(tidyverse) # manipula√ß√£o dos dados
library(janitor) # limpeza dos dados

braco <- c(50:70)
perna <- c(70:90)

data.frame(perna, braco) %>%
  ggplot(aes(x = perna, y = braco)) + 
  geom_point(fill = "black", color = "red", alpha = .9, size = 4) +
  xlab("Bra√ßo (cm)") +
  ylab("Perna (cm)") + 
  theme_bw(base_size = 14) +
  theme(plot.background = element_rect(fill = "transparent", colour = NA))
```
]

---
name: cor_linear
class: middle, center

# Correla√ß√£o linear
---
name: dir
## Correla√ß√£o linear

### Coeficiente de correla√ß√£o produto-momento (r)

- O **r** (*rh√¥*) √© uma medida da for√ßa e dire√ß√£o da correla√ß√£o entre duas vari√°veis quantitativas e tamb√©m √© conhecido como **coeficiente de correla√ß√£o de Pearson**.

.center[<img src="fig/corplot4.png" style="width: 38%;">]

---
## Correla√ß√£o linear

### Dire√ß√£o da correla√ß√£o

.center[<img src="fig/regua2.png" style="width: 40%;">]

<small>
> A partir dos diagramas de dispers√£o, j√° temos uma indica√ß√£o se a rela√ß√£o entre as vari√°veis √© **positiva** (quando as duas crescem juntas), **negativa** (quando uma aumenta e a outra diminui) ou se **n√£o h√° correla√ß√£o**.
</small>

---
## Correla√ß√£o linear

### Intensidade da correla√ß√£o

.center[<img src="fig/inter.png" style="width: 50%;">]

---
name: exe1

## Correla√ß√£o linear

### Exerc√≠cio üíª

Existe associa√ß√£o entre o PIB total (R$) dos munic√≠pios brasileiros e o tamanho de suas popula√ß√µes?

```{r eval=TRUE, message=FALSE, warning=FALSE, include=FALSE}
setwd("C:/Users/mmfav/OneDrive/GitHub/curso_ENAP/Trabalho_final")

## Pacotes ----
library(tidyverse) # manipula√ß√£o dos dados
library(janitor) # limpeza dos dados
library(dados) # cont√©m a planilha de dados

## Importar os dados ----
# ‚Ä¢ Para importar os dados em .csv, utilizamos a fun√ß√£o "read.csv". 
dados_socio_economicos <- 
  read_csv("dados_socio_economicos.csv") %>% # importa√ß√£o da tabela
  clean_names # examinar e limpar os nomes das colunas

dados_socio_economicos %>% names # Consultar as vari√°veis contidas na tabela
```

```{r eval=FALSE, message=FALSE, warning=FALSE, include=TRUE}
## Pacotes ----
library(tidyverse) # manipula√ß√£o dos dados
library(janitor) # limpeza dos dados

## Importar os dados ----
# ‚Ä¢ Para importar os dados em .csv, utilizamos a fun√ß√£o "read.csv". 
dados_socio_economicos <- 
  read_csv("dados_socio_economicos.csv") %>% # importa√ß√£o da tabela
  clean_names # examinar e limpar os nomes das colunas

dados_socio_economicos %>% names # Consultar as vari√°veis contidas na tabela
```

<small>
\#\# [1] "uf" "cod_uf" "cod_municipio" "nome_do_municipio" "populacao_estimada" "pib_per_capita" "pib_total_em_r_mi" <br>
\#\# [2] "atividade_economica" "ranking_pib_per_capita" "ranking_pib_total" 
</small>

---
## Correla√ß√£o linear

### Exerc√≠cio üíª

```{r eval=FALSE, message=FALSE, warning=FALSE, include=TRUE}
## Plotar os dados em um gr√°fico de dispers√£o ---
dados_socio_economicos %>% # tabela de dados
  ggplot(aes(x = populacao_estimada, y = pib_total_em_r_mi)) + # var linha e colunax
  geom_point() + # transpar√™ncia e tamanho dos pontos 
  xlab("Popula√ß√£o estimada") + # nome do eixo X
  ylab("PIB total (R$)") # nome do eixo Y
```

<center>

```{r echo=FALSE, fig.height=4, fig.width=6.5, message=FALSE, warning=FALSE}
library(ggplot2)
library(plotly)
library(gapminder)

p1 <- 
  dados_socio_economicos %>%
  ggplot(aes(x = populacao_estimada, y = pib_total_em_r_mi)) + 
  geom_point(aes(text = c(nome_do_municipio)) ) +
  xlab("Popula√ß√£o estimada") +
  ylab("PIB total (R$)") + 
  theme_bw(base_size = 10) +
  theme(plot.background = element_rect(fill = "transparent", colour = NA),
        legend.position="none") +
  scale_x_continuous(labels = function(x) format(x, scientific = TRUE))

ggplotly(p1, tooltip = c("text"))
```

</center>

---
## Correla√ß√£o linear

### Exerc√≠cio üíª

```{r eval=FALSE, message=FALSE, warning=FALSE, include=TRUE}
## Plotar os dados com transforma√ß√£o nos eixos  ---
dados_socio_economicos %>% 
  ggplot(aes(x = populacao_estimada, y = pib_total_em_r_mi)) + 
  geom_point() +  
  scale_x_log10() + #<< 
  scale_y_log10() + #<<
  xlab("Popula√ß√£o estimada") + ylab("PIB total (R$)") 
```

---
## Correla√ß√£o linear

### Exerc√≠cio üíª

```{r eval=FALSE, message=FALSE, warning=FALSE, include=TRUE}
## Plotar os dados com transforma√ß√£o nos eixos  ---
dados_socio_economicos %>% 
  ggplot(aes(x = populacao_estimada, y = pib_total_em_r_mi)) + 
  geom_point() +  
  scale_x_log10() + # transforma√ß√£o log dados do eixo x
  scale_y_log10() + # transforma√ß√£o log dados do eixo y
  xlab("Popula√ß√£o estimada") + ylab("PIB total (R$)") 
```

<center>

```{r echo=FALSE, fig.height=3.8, fig.width=6.5, message=FALSE, warning=FALSE}
p2 <- 
  dados_socio_economicos %>%
  ggplot(aes(x = populacao_estimada, y = pib_total_em_r_mi)) + 
  geom_point(aes(text = c(nome_do_municipio)) ) +   scale_x_log10() +
  scale_y_log10() +
  xlab("Popula√ß√£o estimada") +
  ylab("PIB total (R$)") + 
  theme_bw(base_size = 10) +
  theme(plot.background = element_rect(fill = "transparent", colour = NA),
        legend.position="none") 


ggplotly(p2, tooltip = c("text"))
```

</center>

---
## Correla√ß√£o linear

### Exerc√≠cio üíª

- Para finalizar, precisamos calcular o **r** para os nossos dados:

```{r}
cor(
  dados_socio_economicos$populacao_estimada, 
  dados_socio_economicos$pib_total_em_r_mi
  )
```

> Existe uma correla√ß√£o **\_\_\_\_\_\_\_\_\_\_**  e **\_\_\_\_\_\_\_\_\_\_** entre a popula√ß√£o estimada e o PIB total (r = **\_\_\_\_**).

---
## Correla√ß√£o linear

### Exerc√≠cio üíª

- Para finalizar, precisamos calcular o **r** para os nossos dados:

```{r}
cor(
  dados_socio_economicos$populacao_estimada, 
  dados_socio_economicos$pib_total_em_r_mi
  )
```

> Existe uma correla√ß√£o **positiva**  e **muito forte** entre a popula√ß√£o estimada e o PIB total (r = **0,96**).

---
name: qui
class: middle, center

# $\chi^2$ de associa√ß√£o
## Res√≠duos ajustados

---
## $\chi^2$ de associa√ß√£o

### Res√≠duos ajustados

- Os res√≠duos do $\chi^2$ (qui-quadrado) de associa√ß√£o ou de independ√™ncia s√£o utilizados para avaliar a correla√ß√£o entre **vari√°veis categ√≥ricas**, assim como o coeficiente **r** √© usado para o mesmo fim com vari√°veis quantitativas. 

- **Exemplo:** 
  - A presen√ßa de doen√ßas respirat√≥rias est√° associado ao tabagismo? (amostra: n = 40).

.center[<img src="fig/cont2.png" style="width: 43%;">]

---
## $\chi^2$ de associa√ß√£o

### Gr√°fico de barras empilhadas

.center[
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=6, fig.width=9}
f <- c("fumante", "fumante", "n√£o fumante", "n√£o fumante")
dr <- c("doen√ßa respirat√≥ria", "saud√°vel", "doen√ßa respirat√≥ria", "saud√°vel")
qt <- c(20, 3, 5, 12)

data.frame(f, dr, qt) %>%
  ggplot(aes(fill = dr, y = qt, x = f)) +
  geom_bar(position = "stack", stat = "identity") +
  labs(legend = "") +
  scale_fill_discrete(name = "") +
  xlab("") +
  ylab("Frequ√™ncia") + 
  theme_bw(base_size = 17) +
  theme(plot.background = element_rect(fill = "transparent", colour = NA))
```
]

---
## $\chi^2$ de associa√ß√£o

### Res√≠duos ajustados

.center[<img src="fig/cont3.png" style="width: 35%;">]

> No **R** usamos a fun√ß√£o `chisq.test(X, Y)$stdres` para obter os $R_{aj}$.

---
name: exe2
## $\chi^2$ de associa√ß√£o

### Exerc√≠cio üíª

- Existe associa√ß√£o entre ra√ßa e identifica√ß√£o partid√°ria para os entrevistados pelo *US General Social Survey*?

```{r}
## Pacotes ----
library(tidyverse) # manipula√ß√£o de dados + gr√°ficos
library(janitor) # limpeza nos dados
library(dados) # onde est√° a tabela de dados
library(viridis) # para usar a paleta de cores viridis
library(corrplot) # usaremos para plotar os res√≠duos

## Chamar os dados da tabela 'questionario'{dados} ----
questionario <- questionario %>% clean_names 

questionario %>% names # vari√°veis da tabela
```

---
## $\chi^2$ de associa√ß√£o

### Exerc√≠cio üíª

.pull-left[
**Gr√°fico de barras empilhadas**

```{r eval=FALSE, message=FALSE, warning=FALSE, include=TRUE}
## Para criar o gr√°fico usamos o pacote 'ggplot'

questionario %>% # incluimos nossos dados
  ggplot(aes(y = raca, # ra√ßa vai no eixo "y"
             fill = partido)) + # as barras empilhadas correspondem a partido
  geom_bar( # usamos a fun√ß√£o "geom_bar" para criar o grafico
    position = "fill" # posi√ß√£o das barras no gr√°fico
    ) + 
  scale_fill_viridis( # usamos a paletta de cores 'viridis'...
    discrete = TRUE, # ... para dados discretos
    name = "Partido") + # t√≠tulo da legenda
  xlab("Frequ√™ncia relativa") + # nome do eixo x
  ylab("Ra√ßa") # nome do eixo y
```
]

.pull-right[
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=6, fig.width=9}
questionario %>% # nossos dados
  ggplot(aes(y = raca, fill = partido)) + # dados para o gr√°fico
  geom_bar(position = "fill") + # tipo de gr√°fico: barra empilhada
  scale_fill_viridis(discrete = TRUE, name = "Partido") + # cores + nome legenda
  theme_bw(base_size = 16) +
  theme(plot.background = element_rect(fill = "transparent", colour = "grey90")) +
  xlab("Frequ√™ncia relativa") +
  ylab("Ra√ßa")
```
]

---
## $\chi^2$ de associa√ß√£o

### Exerc√≠cio üíª

**An√°lise dos res√≠duos**

<div style="width: 1050px; height: 380px; white-space: nowrap; overflow-x: scroll; overflow-y: scroll; 
border: 0; padding: 0px; display: inline-block;">
```{r eval=FALSE, fig.height=6, fig.width=9, message=FALSE, warning=FALSE, include=TRUE}
chisq.test(questionario$raca, 
           questionario$partido)$stdres %>%
  corrplot(is.cor = FALSE)
```

```{r echo=FALSE, fig.height=6, fig.width=12, message=FALSE, warning=FALSE}
chisq.test(questionario$raca, 
           questionario$partido)$stdres %>%
  corrplot(is.cor = FALSE) +
  theme_bw(base_size = 17)
```

> Observamos que h√° uma associa√ß√£o **positiva** entre a ra√ßa preta e o <br>
partido democrata; e entre brancos e o partido republicano.

---
## D√∫vidas?

.center[<img src="fig/qr.png" style="width: 35%;">

<https://www.menti.com/hs6etjj2u9> (cod: 7513-1177)
]

---
class: center

<br>
## FIM!

<br>
.center[<img src="fig/ms.gif" style="width: 60%;">]

